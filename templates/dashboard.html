# Dashboard HTML Template with Interactive Visualizations
<!-- templates/dashboard.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Comment Analysis Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- Chart.js for additional charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
        }
        
        .metric-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .analysis-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .progress-bar-custom {
            height: 8px;
            border-radius: 4px;
        }
        
        .sentiment-positive { color: #28a745; }
        .sentiment-negative { color: #dc3545; }
        .sentiment-neutral { color: #6c757d; }
        
        .wordcloud-container {
            text-align: center;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .export-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body style="background-color: #f8f9fa;">

<!-- Header -->
<div class="dashboard-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-2">üìä AI Comment Analysis Dashboard</h1>
                <p class="mb-0">Analyzing: <strong>{{ filename }}</strong> ‚Ä¢ Session: {{ session_id }}</p>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn export-btn" onclick="exportResults()">
                    üìÑ Export Results
                </button>
                <button class="btn btn-outline-light ms-2" onclick="window.location.href='{{ url_for('upload_file') }}'">
                    üì§ Upload New File
                </button>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid mt-4">
    
    <!-- Key Metrics Row -->
    <div class="row">
        <div class="col-lg-3 col-md-6">
            <div class="metric-card text-center">
                <div class="metric-value">{{ total_comments }}</div>
                <div class="metric-label">Total Comments</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="metric-card text-center">
                <div class="metric-value sentiment-positive">
                    {{ sentiment_dist.get('positive', 0) }}
                </div>
                <div class="metric-label">Positive Comments</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="metric-card text-center">
                <div class="metric-value sentiment-negative">
                    {{ sentiment_dist.get('negative', 0) }}
                </div>
                <div class="metric-label">Negative Comments</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="metric-card text-center">
                <div class="metric-value sentiment-neutral">
                    {{ sentiment_dist.get('neutral', 0) }}
                </div>
                <div class="metric-label">Neutral Comments</div>
            </div>
        </div>
    </div>
    
    <!-- Analysis Progress -->
    <div class="row">
        <div class="col-12">
            <div class="analysis-section">
                <h4>Analysis Progress</h4>
                <div class="progress mb-3">
                    <div class="progress-bar progress-bar-custom" id="progressBar" role="progressbar" style="width: 0%"></div>
                </div>
                <div id="progressStatus">Initializing analysis...</div>
            </div>
        </div>
    </div>
    
    <!-- Charts Row -->
    <div class="row">
        <!-- Sentiment Distribution Chart -->
        <div class="col-lg-6">
            <div class="analysis-section">
                <h4>üìà Sentiment Distribution</h4>
                <div id="sentimentPieChart"></div>
            </div>
        </div>
        
        <!-- Sentiment Trend Chart -->
        <div class="col-lg-6">
            <div class="analysis-section">
                <h4>üìä Sentiment Confidence Scores</h4>
                <div id="confidenceChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Word Cloud and Summary Row -->
    <div class="row">
        <!-- Word Cloud -->
        <div class="col-lg-8">
            <div class="analysis-section">
                <h4>‚òÅÔ∏è Word Cloud</h4>
                <div class="wordcloud-container" id="wordcloudContainer">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Generating word cloud...</span>
                        </div>
                        <p class="mt-2">Generating word cloud...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Key Insights -->
        <div class="col-lg-4">
            <div class="analysis-section">
                <h4>üîç Key Insights</h4>
                <div id="keyInsights">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">Analyzing insights...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Summary Section -->
    <div class="row">
        <div class="col-12">
            <div class="analysis-section">
                <h4>üìù AI-Generated Summary</h4>
                <div id="summaryContent">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">Generating summary...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Top Keywords Section -->
    <div class="row">
        <div class="col-12">
            <div class="analysis-section">
                <h4>üè∑Ô∏è Top Keywords & Phrases</h4>
                <div id="keywordsContent">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">Extracting keywords...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Global variables
const sessionId = "{{ session_id }}";
const filename = "{{ filename }}";
let analysisComplete = false;

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    initializeDashboard();
    startAnalysis();
});

function initializeDashboard() {
    // Create initial sentiment pie chart
    createSentimentPieChart();
    
    // Load word cloud
    loadWordCloud();
}

function createSentimentPieChart() {
    const sentimentData = {{ sentiment_dist | tojsonfilter }};
    
    const data = [{
        values: Object.values(sentimentData),
        labels: Object.keys(sentimentData).map(label => 
            label.charAt(0).toUpperCase() + label.slice(1)
        ),
        type: 'pie',
        hole: 0.4,
        marker: {
            colors: ['#28a745', '#dc3545', '#6c757d']
        },
        textinfo: 'label+percent',
        textposition: 'outside'
    }];
    
    const layout = {
        showlegend: true,
        legend: {
            orientation: 'h',
            x: 0.5,
            xanchor: 'center',
            y: -0.1
        },
        margin: { t: 20, b: 50, l: 20, r: 20 },
        font: { family: 'Arial, sans-serif' }
    };
    
    Plotly.newPlot('sentimentPieChart', data, layout, {responsive: true});
}

function startAnalysis() {
    // Simulate analysis progress
    let progress = 0;
    const progressBar = document.getElementById('progressBar');
    const progressStatus = document.getElementById('progressStatus');
    
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = progress + '%';
        
        // Update status based on progress
        if (progress < 30) {
            progressStatus.textContent = 'Processing sentiment analysis...';
        } else if (progress < 60) {
            progressStatus.textContent = 'Generating text summaries...';
        } else if (progress < 90) {
            progressStatus.textContent = 'Extracting keywords and themes...';
        } else {
            progressStatus.textContent = 'Finalizing analysis...';
        }
        
        if (progress >= 100) {
            clearInterval(interval);
            progressStatus.textContent = 'Analysis complete!';
            completeAnalysis();
        }
    }, 500);
    
    // Start actual API analysis
    fetchAnalysisResults();
}

function fetchAnalysisResults() {
    fetch(`/api/analyze/${sessionId}/${filename}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                console.error('Analysis error:', data.error);
                return;
            }
            
            // Update confidence chart
            createConfidenceChart(data.sentiment_analysis.confidence_scores);
            
            // Update summary
            updateSummary(data.summarization.summary);
            
            // Update keywords
            updateKeywords(data.keywords);
            
            // Update insights
            updateInsights(data);
            
            analysisComplete = true;
        })
        .catch(error => {
            console.error('Error fetching analysis:', error);
        });
}

function createConfidenceChart(confidenceScores) {
    // Create a histogram of confidence scores
    if (!confidenceScores || confidenceScores.length === 0) return;
    
    const scores = confidenceScores.slice(0, 100).map(item => item.confidence);
    
    const trace = {
        x: scores,
        type: 'histogram',
        nbinsx: 20,
        marker: {
            color: 'rgba(100, 126, 234, 0.7)',
            line: {
                color: 'rgba(100, 126, 234, 1)',
                width: 1
            }
        }
    };
    
    const layout = {
        title: 'Distribution of Confidence Scores',
        xaxis: { title: 'Confidence Score' },
        yaxis: { title: 'Count' },
        margin: { t: 50, b: 50, l: 50, r: 20 }
    };
    
    Plotly.newPlot('confidenceChart', [trace], layout, {responsive: true});
}

function loadWordCloud() {
    const wordcloudContainer = document.getElementById('wordcloudContainer');
    
    // Show loading spinner initially
    document.querySelector('#wordcloudContainer .loading-spinner').style.display = 'block';
    
    // Load word cloud image
    const img = new Image();
    img.onload = function() {
        wordcloudContainer.innerHTML = `<img src="${this.src}" class="img-fluid" alt="Word Cloud">`;
    };
    img.onerror = function() {
        wordcloudContainer.innerHTML = '<p class="text-muted">Word cloud generation in progress...</p>';
    };
    img.src = `/word-cloud/${sessionId}/${filename}`;
}

function updateSummary(summary) {
    const summaryContainer = document.getElementById('summaryContent');
    
    if (summary) {
        summaryContainer.innerHTML = `
            <div class="alert alert-info">
                <h6>üìã Executive Summary</h6>
                <p class="mb-0">${summary}</p>
            </div>
        `;
    } else {
        summaryContainer.innerHTML = '<p class="text-muted">Summary generation in progress...</p>';
    }
}

function updateKeywords(keywords) {
    const keywordsContainer = document.getElementById('keywordsContent');
    
    if (keywords && keywords.length > 0) {
        const keywordBadges = keywords.slice(0, 20).map(keyword => 
            `<span class="badge bg-primary me-2 mb-2" style="font-size: 0.9rem;">${keyword}</span>`
        ).join('');
        
        keywordsContainer.innerHTML = `
            <div class="d-flex flex-wrap">
                ${keywordBadges}
            </div>
        `;
    } else {
        keywordsContainer.innerHTML = '<p class="text-muted">Keyword extraction in progress...</p>';
    }
}

function updateInsights(data) {
    const insightsContainer = document.getElementById('keyInsights');
    
    const sentimentDist = data.sentiment_analysis.distribution;
    const total = Object.values(sentimentDist).reduce((a, b) => a + b, 0);
    
    // Calculate percentages
    const positivePercent = ((sentimentDist.positive || 0) / total * 100).toFixed(1);
    const negativePercent = ((sentimentDist.negative || 0) / total * 100).toFixed(1);
    const neutralPercent = ((sentimentDist.neutral || 0) / total * 100).toFixed(1);
    
    // Determine overall sentiment
    let overallSentiment = 'Neutral';
    let sentimentClass = 'text-muted';
    
    if (positivePercent > negativePercent && positivePercent > 40) {
        overallSentiment = 'Positive';
        sentimentClass = 'text-success';
    } else if (negativePercent > positivePercent && negativePercent > 40) {
        overallSentiment = 'Negative';
        sentimentClass = 'text-danger';
    }
    
    insightsContainer.innerHTML = `
        <div class="mb-3">
            <h6>Overall Sentiment</h6>
            <h4 class="${sentimentClass}">${overallSentiment}</h4>
        </div>
        
        <div class="mb-3">
            <h6>Breakdown</h6>
            <div class="mb-2">
                <small class="text-success">Positive:</small>
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-success" style="width: ${positivePercent}%"></div>
                </div>
                <small>${positivePercent}%</small>
            </div>
            
            <div class="mb-2">
                <small class="text-danger">Negative:</small>
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-danger" style="width: ${negativePercent}%"></div>
                </div>
                <small>${negativePercent}%</small>
            </div>
            
            <div class="mb-2">
                <small class="text-muted">Neutral:</small>
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-secondary" style="width: ${neutralPercent}%"></div>
                </div>
                <small>${neutralPercent}%</small>
            </div>
        </div>
        
        <div class="alert alert-light">
            <small class="text-muted">
                <strong>Recommendation:</strong> 
                ${positivePercent > 60 ? 'Strong positive sentiment indicates high satisfaction.' : 
                  negativePercent > 40 ? 'Address negative feedback to improve satisfaction.' : 
                  'Mixed sentiment suggests room for improvement.'}
            </small>
        </div>
    `;
}

function completeAnalysis() {
    // Hide all loading spinners
    document.querySelectorAll('.loading-spinner').forEach(spinner => {
        spinner.style.display = 'none';
    });
    
    // Enable export button
    document.querySelector('.export-btn').disabled = false;
}

function exportResults() {
    if (!analysisComplete) {
        alert('Please wait for analysis to complete before exporting.');
        return;
    }
    
    // Trigger download
    window.location.href = `/export/${sessionId}/${filename}`;
}
</script>

</body>
</html>